<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Shop Frontend</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>Shop products</h1>

  <section>
    <h2>create products</h2>
    <form id="item-form">
      <label for="name">Name</label>
      <input id="name" name="name" required />

      <label for="price">price (â‚¬)</label>
      <input id="price" name="price" type="number" step="0.01" required />

      <label for="description">description</label>
      <textarea id="description" name="description"></textarea>

      <div class="form-actions">
        <button type="submit">save product </button>
      </div>
    </form>
    <div id="form-message"></div>
  </section>

  <section>
    <h2>product list</h2>
    <button id="reload-btn">Neu laden</button>
    <div id="items-container"></div>
  </section>

  <script>

    async function fetchItems() {
      const container = document.getElementById('items-container');
      container.textContent = 'Lade Produkte...';

      try {
        const res = await fetch(`api/items`);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const items = await res.json();

        if (!Array.isArray(items) || items.length === 0) {
          container.textContent = 'no products in database.';
          return;
        }

        const table = document.createElement('table');
        const thead = document.createElement('thead');
        thead.innerHTML = `
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Price</th>
            <th>Description</th>
            <th>creation date</th>
          </tr>
        `;
        table.appendChild(thead);

        const tbody = document.createElement('tbody');
        items.forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.id}</td>
            <td>${item.name}</td>
            <td>${item.price}</td>
            <td>${item.description || ''}</td>
            <td>${item.created_at || ''}</td>
          `;
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);

        container.innerHTML = '';
        container.appendChild(table);
      } catch (err) {
        container.textContent = `Error while loading the products: ${err.message}`;
      }
    }

    async function createItem(event) {
      event.preventDefault();
      const form = event.target;
      const messageEl = document.getElementById('form-message');
      messageEl.textContent = '';

      const name = document.getElementById('name').value.trim();
      const price = parseFloat(document.getElementById('price').value);
      const description = document.getElementById('description').value.trim();

      if (!name || Number.isNaN(price)) {
        messageEl.textContent = 'please add a valid price.';
        return;
      }

      try {
        const res = await fetch(`api/items`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, price, description })
        });

        if (!res.ok) {
          const errBody = await res.json().catch(() => ({}));
          throw new Error(errBody.error || `HTTP ${res.status}`);
        }

        messageEl.textContent = 'product registered sucesfully.';
        form.reset();
        await fetchItems();
      } catch (err) {
        messageEl.textContent = `error during creation: ${err.message}`;
      }
    }

    document.getElementById('item-form').addEventListener('submit', createItem);
    document.getElementById('reload-btn').addEventListener('click', fetchItems);

    fetchItems();
  </script>
</body>
</html>